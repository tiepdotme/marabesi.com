<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>e2e testing with Cypress, ReactJs and Firebase</title>
    <meta name="description"
      content="Cypress is a e2e testing tool that interacts with chrome based browsers (and electron) toexecute its test suite [1]. E2e testing is known by its complexity, ...">

    <link rel="canonical" href="https://marabesi.com/test/2019/10/13/cypress-and-firebase-reactjs-app.html">
    <link rel="alternate" type="application/rss+xml" title="Marabesi"
      href="https://marabesi.com/feed.xml">

    <meta property="og:title" content="e2e testing with Cypress, ReactJs and Firebase" />
    <meta property="og:site_name" content="marabesi.com" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://marabesi.com/test/2019/10/13/cypress-and-firebase-reactjs-app.html" />
    <meta property="og:image"
      content="https://marabesi.com/images/manifest/icon-192x192.png" />
    <meta property="og:description"
      content="Cypress is a e2e testing tool that interacts with chrome based browsers (and electron) toexecute its test suite [1]. E2e testing is known by its complexity, ..." />

    <meta property="fb:app_id" content="536384943068161" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@MatheusMarabesi">
    <meta name="twitter:title" content="e2e testing with Cypress, ReactJs and Firebase">
    <meta name="twitter:description"
      content="Cypress is a e2e testing tool that interacts with chrome based browsers (and electron) toexecute its test suite [1]. E2e testing is known by its complexity, ...">
    <meta name="twitter:creator" content="@MatheusMarabesi">
    <meta name="twitter:image:src"
      content="https://marabesi.com/images/manifest/icon-192x192.png">

    <meta name="keywords" content="web,js,redux,javascript,reactjs,ReactJs,e2e,cypress,Cypress,testing,test,solution,docs,firebase,Firebase,Online,github,sdk,https,store,Redux" />

    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

    <link href="/assets/main-bundle.css" rel="stylesheet" />

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#3f51b5">

    <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Marabesi">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Marabesi">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="/images/manifest/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/manifest/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/images/manifest/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/manifest/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/images/manifest/icon-192x192.png">

    <!-- Tile icon for Windows 8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/manifest/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3f51b5">
    <meta name="msapplication-tap-highlight" content="no">
  </head>

  <body class="font-sans overflow-x-hidden">
    <button class="update-button w-full text-white bg-marabesi-purple p-5 m-auto fixed pin-b z-50 hidden focus:outline-none font-bold">Update found, click to update</button>

    <div class="menu-wrapper flex fixed w-full bg-white z-50">
      <nav class="top-menu hidden md:flex justify-start container lg:justify-center md:m-auto md:pt-2 md:pb-2">
        <a href="/" class="hidden md:block">
          <img class="logo w-18 p-1" data-src="/images/logo.png" width="100" alt="marabesi.com logo - two m's and one dot" title="marabesi.com logo - two m's and one dot" />
        </a>

        <ul id="menu-list" class="container-menu hidden flex-col pl-5 md:flex md:pl-0 md:flex-row md:m-auto lg:m-0">
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/talks">
                Talks
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/about">
                About
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/newbie-guide">
                Dev guide
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/resources">
                software development
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/tests/">
                Tests
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/calendar">
                Conferences
              </a>
            </li>
          
          
        </ul>
      </nav>

      <div class="w-full flex items-center h-12 pl-2 bg-white md:hidden">
        <svg id="menu" class="cursor-pointer w-10 h-10 p-2 text-marabesi-pink fill-current" xmlns="http://www.w3.org/2000/svg"
          x="0px" y="0px" width="50" height="50" viewBox="0 0 24 24">
          <path
            style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal"
            d="M 2 5 L 2 7 L 22 7 L 22 5 L 2 5 z M 2 11 L 2 13 L 22 13 L 22 11 L 2 11 z M 2 17 L 2 19 L 22 19 L 22 17 L 2 17 z"
            font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"></path>
        </svg>
      </div>
    </div>

    <div class="flex flex-col items-center justify-center p-5">
      <input type="text" id="search-input" placeholder="search" aria-label="search" class="focus:outline-none border border-marabesi-purple text-marabesi-purple w-full p-3 mb-2 container mt-20 lg:mt-12">
      <ul id="results-container"></ul>
    </div>

    <div class="shell-content">
      <div class="banner-highlight">
        <p class="font-normal text-lg py-4 md:text-3xl lg:text-4xl">
          <span class="apostrophe">‘‘</span>
          Code should be easy to understand.
          <span class="apostrophe">’’</span>
        </p>
        <p class="author text-xs">Dustin Boswell and Trevor Foucher - The Art Of Readable Code</p>
      </div>

        <div class="page-content container flex flex-col p-5 m-auto">
  <h1>e2e testing with Cypress, ReactJs and Firebase</h1>

  <main class="mb-5">
    <p>Cypress is a e2e testing tool that interacts with chrome based browsers (and electron) to
execute its test suite <strong>[1]</strong>. E2e testing is known by its complexity, and often it is
related to the top in the test pyramid <strong>[2]</strong>.</p>

<p>The complexity comes from the amount of work and setup to do before performing the
test itself. To put in context, unit test usually is the easiest in the spectrum,
whereas the developer write test methods to cover a class behavior. The setup
to be done is the smallest.</p>

<p>The havy setup is due the interaction between components, in a e2e testing, everything
is working the “production” way. Often this behavior is not desired, for that
Cypress provides a mock library. For example, the <code class="language-plaintext highlighter-rouge">cy.route</code> is used to mock
network requests. Using the network mock, prevents the need to setup a entire
backend to interact with the web app <strong>[3]</strong>.</p>

<h2 id="firebase">Firebase</h2>

<p>Firebase is a library maintained by Google, which has many products inside it.
In specific the real time database (or more recent firestore) is a Firebase
product that allows developers to write real time applications.</p>

<p>It has a vast library that integrates with many programming languages, the firebase
app has support for iOS, Android and Web (javascript) <strong>[4]</strong>. The server side supports more technologies <strong>[5]</strong>.</p>

<h2 id="cypress-and-firebase">Cypress and Firebase</h2>

<p>Web applications that uses Firebase as a service to provide real time database
integration have a challenge beyond the <code class="language-plaintext highlighter-rouge">cy.route</code> that Cypress provides.
Firebase uses a specific protocol to communicate with its server, which is not a
ajax requests. In this sense, using <code class="language-plaintext highlighter-rouge">cy.route</code> is not effective, as it is
based on ajax requests only.</p>

<h2 id="proposed-solution-redux-and-reactjs">Proposed solution: redux and ReactJs</h2>

<p>The first alternative is Redux <strong>[6]</strong>. Redux provides a pattern to abstract the
data of the application from the UI. In this sense, acting in the data part
reflects the UI due its separation of concerns. Redux is a implementation of
Flux a pattern, a one way flow to mutate data <strong>[7]</strong>.</p>

<p>This solution, depend on the redux understanding. In other words, redux is a must.
Applications that use Firebase and ReactJs only, can’t benefit. If that is the
case there are solutions that try to tackle this case <strong>[8][9]</strong>.</p>

<p>To follow on the ReactJs and the redux solution, the app must follow two
basic rules:</p>

<ol>
  <li>Calls to the firebase API must be inside reducers</li>
  <li>The app must depend on the redux state only</li>
</ol>

<p>The next step is to expose the redux store through the <code class="language-plaintext highlighter-rouge">window</code> object. This step
is required, so Cypress can access the store and commit actions to change the
state as needed <strong>[12]</strong>.</p>

<p>This solution is interesting, as it isolates the dependency from Firebase. It
is like <code class="language-plaintext highlighter-rouge">cy.route</code> in this sense. Testable is a project that follows this approach
<strong>[11]</strong>. To understand the big picture of the implementation is recommended
to check the <a href="https://github.com/marabesi/testable/blob/master/webapp/src/reducers/userReducer.js" target="_blank"><code class="language-plaintext highlighter-rouge">userReducer.js</code></a>,
this file follows the first rule. In addition to the the file <a href="https://github.com/marabesi/testable/blob/master/webapp/src/index.js" target="_blank"><code class="language-plaintext highlighter-rouge">index.js</code></a> exposes the store to the <code class="language-plaintext highlighter-rouge">window</code> object, as described before.</p>

<p>The second rule can be checked in the <code class="language-plaintext highlighter-rouge">pages</code> and <code class="language-plaintext highlighter-rouge">components</code> directory, as
all of them should’t dispatch Firebase interactions.</p>

<p>Interesting enough, exposing the store to the <code class="language-plaintext highlighter-rouge">window</code> object might fit other
libraries/frameworks as well. This approach is not related to ReactJs + Redux only,
but to any Flux implementation. As an example, Vuex can also benefit from this approach.</p>

<h2 id="related-work">Related work</h2>

<p>Previous work have shown that the solution proposed in the previous sections is
effective to remove the dependency from Firebase. Indeed, <strong>[10]</strong> has a step by
step tutorial in how to achieve that.</p>

<h2 id="references">References</h2>

<p>[1] [Online]. Available: <a href="https://docs.cypress.io/guides/core-concepts/launching-browsers.html#Browsers" target="_blank">https://docs.cypress.io/guides/core-concepts/launching-browsers.html#Browsers</a></p>

<p>[2] Ham Vocke, ‘The Practical Test Pyramid’, 2018. [Online]. Available: <a href="https://martinfowler.com/articles/practical-test-pyramid.html" target="_blank">https://martinfowler.com/articles/practical-test-pyramid.html</a></p>

<p>[3] [Online]. Available: <a href="https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies" target="_blank">https://docs.cypress.io/guides/guides/network-requests.html#Testing-Strategies</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[4] [Online]. Available: <a href="https://firebase.google.com/docs/ios/setup" target="_blank">https://firebase.google.com/docs/ios/setup</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[5] [Online]. Available: <a href="https://firebase.google.com/docs/admin/setup#add_the_sdk" target="_blank">https://firebase.google.com/docs/admin/setup#add_the_sdk</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[6] [Online]. Available: <a href="https://redux.js.org" target="_blank">https://redux.js.org</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[7] [Online]. Available: <a href="https://facebook.github.io/flux/docs/in-depth-overview" target="_blank">https://facebook.github.io/flux/docs/in-depth-overview</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[8] [Online]. Available: <a href="https://github.com/prescottprue/cypress-firebase" target="_blank">https://github.com/prescottprue/cypress-firebase</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[9] [Online]. Available: <a href="https://github.com/cypress-io/cypress-example-recipes/issues/118" target="_blank">https://github.com/cypress-io/cypress-example-recipes/issues/118</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[10] [Online]. Available: <a href="https://www.cypress.io/blog/2018/11/14/testing-redux-store/#drive-using-the-dom" target="_blank">https://www.cypress.io/blog/2018/11/14/testing-redux-store/#drive-using-the-dom</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[11] [Online]. Available: <a href="https://github.com/marabesi/testable/tree/master/webapp" target="_blank">https://github.com/marabesi/testable/tree/master/webapp</a>. [Accessed: 31 - Oct - 2019]</p>

<p>[12] [Online]. Available: <a href="https://stackoverflow.com/a/52590453/2258921" target="_blank">https://stackoverflow.com/a/52590453/2258921</a>. [Accessed: 31 - Oct - 2019]</p>

  </main>

  

<style>
#share-buttons {display: flex; justify-content: center; align-items: center;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #f12f46; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<div id="share-buttons" class="mb-5">
    <span>Share this on</span>
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://marabesi.com/test/2019/10/13/cypress-and-firebase-reactjs-app.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https://marabesi.com/test/2019/10/13/cypress-and-firebase-reactjs-app.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://marabesi.com/test/2019/10/13/cypress-and-firebase-reactjs-app.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
</div>

  <div id="disqus_thread"></div>
</div>


      <div class="footer">
        <div class="footer-details">
          Designed by @tamyitokazo
        </div>
      </div>
    </div>

    
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-58623708-1', 'auto');
      ga('send', 'pageview');
    </script>
    

    <script async src="/assets/main-bundle.js"></script>
  </body>
</html>