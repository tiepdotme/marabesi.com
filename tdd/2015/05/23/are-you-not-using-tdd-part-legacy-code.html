<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>ARE YOU NOT USING TDD?! – PART || (Legacy code)</title>
    <meta name="description"
      content="In the part one I introduced the life cycle of TDDyou can see here and how it works, but often people come to me and ask about the legacy code how can we sta...">

    <link rel="canonical" href="https://marabesi.com/tdd/2015/05/23/are-you-not-using-tdd-part-legacy-code.html">
    <link rel="alternate" type="application/rss+xml" title="Marabesi"
      href="https://marabesi.com/feed.xml">

    <meta property="og:title" content="ARE YOU NOT USING TDD?! – PART || (Legacy code)" />
    <meta property="og:site_name" content="marabesi.com" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://marabesi.com/tdd/2015/05/23/are-you-not-using-tdd-part-legacy-code.html" />
    <meta property="og:image"
      content="https://marabesi.com/images/posts/2015-05-23-are-you-not-using-tdd-part-legacy-code/cover.png" />
    <meta property="og:description"
      content="In the part one I introduced the life cycle of TDDyou can see here and how it works, but often people come to me and ask about the legacy code how can we sta..." />

    <meta property="fb:app_id" content="536384943068161" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@MatheusMarabesi">
    <meta name="twitter:title" content="ARE YOU NOT USING TDD?! – PART || (Legacy code)">
    <meta name="twitter:description"
      content="In the part one I introduced the life cycle of TDDyou can see here and how it works, but often people come to me and ask about the legacy code how can we sta...">
    <meta name="twitter:creator" content="@MatheusMarabesi">
    <meta name="twitter:image:src"
      content="https://marabesi.com/images/posts/2015-05-23-are-you-not-using-tdd-part-legacy-code/cover.png">

    <meta name="keywords" content="code base,features,legacy code,lines,tdd,legacy" />

    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

    <link href="/assets/main-bundle.css" rel="stylesheet" />

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#3f51b5">

    <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Marabesi">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Marabesi">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="/images/manifest/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/manifest/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/images/manifest/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/manifest/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/images/manifest/icon-192x192.png">

    <!-- Tile icon for Windows 8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/manifest/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3f51b5">
    <meta name="msapplication-tap-highlight" content="no">
  </head>

  <body class="font-sans overflow-x-hidden">
    <button class="update-button w-full text-white bg-marabesi-purple p-5 m-auto fixed pin-b z-50 hidden focus:outline-none font-bold">Update found, click to update</button>

    <div class="menu-wrapper flex fixed w-full bg-white z-50">
      <nav class="top-menu hidden md:flex justify-start container lg:justify-center md:m-auto md:pt-2 md:pb-2">
        <a href="/" class="hidden md:block">
          <img class="logo w-18 p-1" data-src="/images/logo.png" width="100" alt="marabesi.com logo - two m's and one dot" title="marabesi.com logo - two m's and one dot" />
        </a>

        <ul id="menu-list" class="container-menu hidden flex-col pl-5 md:flex md:pl-0 md:flex-row md:m-auto lg:m-0">
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/talks">
                Talks
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/about">
                About
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/newbie-guide">
                Dev guide
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/resources">
                software development
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/tests/">
                Tests
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/calendar">
                Conferences
              </a>
            </li>
          
          
        </ul>
      </nav>

      <div class="w-full flex items-center h-12 pl-2 bg-white md:hidden">
        <svg id="menu" class="cursor-pointer w-10 h-10 p-2 text-marabesi-pink fill-current" xmlns="http://www.w3.org/2000/svg"
          x="0px" y="0px" width="50" height="50" viewBox="0 0 24 24">
          <path
            style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal"
            d="M 2 5 L 2 7 L 22 7 L 22 5 L 2 5 z M 2 11 L 2 13 L 22 13 L 22 11 L 2 11 z M 2 17 L 2 19 L 22 19 L 22 17 L 2 17 z"
            font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"></path>
        </svg>
      </div>
    </div>

    <div class="flex flex-col items-center justify-center p-5">
      <input type="text" id="search-input" placeholder="search" aria-label="search" class="focus:outline-none border border-marabesi-purple text-marabesi-purple w-full p-3 mb-2 container mt-20 lg:mt-12">
      <ul id="results-container"></ul>
    </div>

    <div class="shell-content">
      <div class="banner-highlight">
        <p class="font-normal text-lg py-4 md:text-3xl lg:text-4xl">
          <span class="apostrophe">‘‘</span>
          Code should be easy to understand.
          <span class="apostrophe">’’</span>
        </p>
        <p class="author text-xs">Dustin Boswell and Trevor Foucher - The Art Of Readable Code</p>
      </div>

        <div class="page-content container flex flex-col p-5 m-auto">
  <h1>ARE YOU NOT USING TDD?! – PART || (Legacy code)</h1>

  <main class="mb-5">
    <p>In the part one I introduced the life cycle of TDD
<a href="/tdd/2015/04/19/not-using-tdd-part-1.html">you can see here</a> and how it works, but often people come to me and ask about the legacy code how can we start
using TDD with legacy code? Should we start from zero? Should we use baby-steps?</p>

<p>I decided to share my experience in how I used TDD in legacy code and how I did
to get this task done also I have to say many thanks to my friend Alexandre
Cintra who helped my a lot giving me gold tips.</p>

<h2 id="edit-jun-17-2015">Edit: Jun 17, 2015</h2>

<p>You can find useful information in my slides below. It was created for
<a href="http://www.meetup.com/pt/THT-Things-Hacker-Team/events/222831499" target="_blank">my talk at Samsung Ocean</a>.</p>

<iframe width="100%" height="500" style="border: 1px solid #CCC; border-width: 1px; margin-bottom: 5px; max-width: 100%;" src="//www.slideshare.net/slideshow/embed_code/key/vO17674rb2GiBI" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" allowfullscreen="allowfullscreen"> </iframe>

<h2 id="edit-july28-2015">Edit: July 28, 2015</h2>

<p>Legacy software systems . . . were developed decades ago and have been
continually modified to meet changes in business requirements and computing
platforms. The proliferation of such systems is causing headaches for
large organizations who find them costly to maintain and risky to evolve -
Dayani-Fard</p>

<h2 id="legacy-code-the-nightmare-of-everyone">Legacy code the nightmare of everyone</h2>

<p>Doesn’t matter if you are in a big company or a small one it is normal to have
legacy code and you will need to maintain and even do some improvements as the
request of our client comes.</p>

<p>How can I identify legacy that is impossible to test?</p>

<ol>
  <li>
    <p>Many responsibilities: Usually legacy code has many lines between 1000 and
2000 (I’ve seen many with 3000) and do everything in one file database
connection, data persistence, business logic, IO are a couple of examples.</p>
  </li>
  <li>
    <p>Without code pattern: A “great” feature of legacy code is the lack of
pattern in its code. When you touch the code base you usually see huge
files and also blank files, once I was just playing around in a company
repository and I saw a model without one single line just with its declaration
therefore in the controller was everything else the access data, DAO and
even the queries were wrote in the controller!</p>
  </li>
</ol>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="kd">class</span> <span class="nc">MyLegacyClass</span> <span class="p">{</span>
	
	    <span class="c1">// omitted code with 50 lines also construct method and some properties was took off</span>
            <span class="k">public</span> <span class="k">function</span> <span class="n">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">)</span> <span class="p">{</span>
            	<span class="k">try</span> <span class="p">{</span>
            		<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">xml</span> <span class="o">=</span> <span class="nv">$xml</span><span class="p">;</span>
            		<span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
            	<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">exit</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
            	<span class="p">}</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">getXml</span><span class="p">()</span> <span class="p">{</span>
            	<span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">xml</span><span class="p">;</span>
            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">getModalRodoviario</span><span class="p">()</span> <span class="p">{</span>
            	<span class="k">try</span> <span class="p">{</span>
            		<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>
            		<span class="k">return</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">rodo</span><span class="p">;</span>
            	<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">exit</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
            	<span class="p">}</span>
            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">printXML</span><span class="p">()</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>
            	<span class="k">print</span><span class="p">(</span><span class="nv">$xml</span><span class="o">-&gt;</span><span class="nf">asXML</span><span class="p">());</span>
            	<span class="k">exit</span><span class="p">;</span>
            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">setIdeValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">,</span> <span class="nv">$Cte</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$ide</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ide'</span><span class="p">);</span>

            	<span class="nv">$confIde</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">;</span>

            	<span class="nv">$camposObrigatoriosConfIde</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
			<span class="c1">//omitted code 31 lines</span>
            	<span class="p">);</span>

            	<span class="nv">$confToma</span> <span class="o">=</span> <span class="nv">$confIde</span><span class="p">[</span><span class="s1">'toma'</span><span class="p">];</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$confToma</span> <span class="o">==</span> <span class="s1">'4'</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$confToma4</span> <span class="o">=</span> <span class="nv">$confIde</span><span class="p">[</span><span class="s1">'toma4'</span><span class="p">];</span>
            		<span class="nb">unset</span><span class="p">(</span><span class="nv">$confIde</span><span class="p">[</span><span class="s1">'toma4'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nb">unset</span><span class="p">(</span><span class="nv">$confIde</span><span class="p">[</span><span class="s1">'toma'</span><span class="p">]);</span>

            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'cUF'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">estadosIBGE</span><span class="p">[</span><span class="nv">$confIde</span><span class="p">[</span><span class="s1">'cUF'</span><span class="p">]];</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chaveAcesso</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">calculaChaveAcesso</span><span class="p">(</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'cUF'</span><span class="p">],</span>
            	<span class="nb">substr</span><span class="p">(</span><span class="nb">str_replace</span><span class="p">(</span><span class="s1">'-'</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$confIde</span><span class="p">[</span><span class="s1">'dhEmi'</span><span class="p">]),</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
            	<span class="nv">$Cte</span><span class="p">[</span><span class="s1">'Empresa'</span><span class="p">][</span><span class="s1">'Entidade'</span><span class="p">][</span><span class="s1">'ent_cnpj'</span><span class="p">],</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'mod'</span><span class="p">],</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'serie'</span><span class="p">],</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'nCT'</span><span class="p">],</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'tpEmis'</span><span class="p">],</span>
            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'cCT'</span><span class="p">]</span>
            	<span class="p">);</span>

            	<span class="nv">$Cte</span><span class="o">-&gt;</span><span class="n">cte_chave</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chaveAcesso</span><span class="p">;</span>

            	<span class="nv">$Cte</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

            	<span class="nv">$confIde</span><span class="p">[</span><span class="s1">'cDV'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">digVer</span><span class="p">;</span>

            	<span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addAttribute</span><span class="p">(</span><span class="s1">'Id'</span><span class="p">,</span> <span class="s1">'CTe'</span> <span class="mf">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="n">chaveAcesso</span><span class="p">);</span>

            	<span class="k">foreach</span><span class="p">(</span><span class="nv">$confIde</span> <span class="k">as</span> <span class="nv">$node</span> <span class="o">=&gt;</span> <span class="nv">$nodeValue</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">if</span><span class="p">(</span><span class="nv">$nodeValue</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$nodeValue</span><span class="p">))</span> <span class="p">{</span>
            			<span class="nv">$ide</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$nodeValue</span><span class="p">);</span>
            		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            			<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$camposObrigatoriosConfIde</span><span class="p">))</span>
            			<span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="nv">$camposObrigatoriosConfIde</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="c1">//		exit;</span>
            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">))</span> <span class="p">{</span>
            		<span class="nv">$toma4</span> <span class="o">=</span> <span class="nv">$ide</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'toma4'</span><span class="p">);</span>
            		<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'toma'</span><span class="p">,</span> <span class="nv">$confToma</span><span class="p">);</span>
            		 
            		<span class="nv">$camposObrigatoriosTomador</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
				<span class="c1">//omitted code 9 lines</span>
            		<span class="p">);</span>
            		 
            		<span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_data_ent_cont'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d H:i:s'</span><span class="p">);</span>
            		<span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_justificativa_cont'</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Justificativa teste"</span><span class="p">;</span>
            		 
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$camposObrigatoriosTomador</span> <span class="k">as</span> <span class="nv">$campo</span> <span class="o">=&gt;</span> <span class="nv">$mensagemErro</span><span class="p">)</span> <span class="p">{</span>
            			<span class="k">if</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="nv">$campo</span><span class="p">]</span> <span class="o">==</span> <span class="s2">""</span><span class="p">)</span>
            			<span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="nv">$mensagemErro</span><span class="p">);</span>
            		<span class="p">}</span>
            		 
            		<span class="nv">$dePara</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
				<span class="s1">'fone'</span> <span class="o">=&gt;</span> <span class="s1">'toma_telefone'</span><span class="p">,</span>
				<span class="s1">'xLgr'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_logradouro'</span><span class="p">,</span>
				<span class="s1">'nro'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_nro'</span><span class="p">,</span>
				<span class="s1">'xCpl'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_cpl'</span><span class="p">,</span>
				<span class="s1">'xBairro'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_bairo'</span><span class="p">,</span>
				<span class="s1">'cMun'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_cod_mun'</span><span class="p">,</span>
				<span class="s1">'xMun'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_mun'</span><span class="p">,</span>
				<span class="s1">'UF'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_uf_sigla'</span><span class="p">,</span>
            		<span class="c1">//'CEP' =&gt; 'toma_end_cep',</span>
				<span class="s1">'cPais'</span> <span class="o">=&gt;</span> <span class="s1">'toma_cod_end_pais'</span><span class="p">,</span>
				<span class="s1">'xPais'</span> <span class="o">=&gt;</span> <span class="s1">'toma_end_pais'</span><span class="p">,</span>
				<span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="s1">'toma_cont_email'</span><span class="p">,</span>
            		<span class="c1">//'xJust' =&gt; 'toma_justificativa_cont'</span>
            		<span class="p">);</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_cpf_cnpj'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">11</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_cpf_cnpj'</span><span class="p">]);</span>
            			<span class="k">if</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_nome'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_nome'</span><span class="p">]);</span>
            		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            			<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_cpf_cnpj'</span><span class="p">]);</span>
            			<span class="k">if</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_fantasia'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xFant'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_fantasia'</span><span class="p">]);</span>
            			<span class="k">if</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_ie'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_ie'</span><span class="p">]);</span>
            		<span class="p">}</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_telefone'</span><span class="p">]))</span>
            		<span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="s1">'toma_telefone'</span><span class="p">]);</span>
            		 
            		<span class="nv">$enderToma</span> <span class="o">=</span> <span class="nv">$toma4</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderToma'</span><span class="p">);</span>

            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$dePara</span> <span class="k">as</span> <span class="nv">$de</span> <span class="o">=&gt;</span> <span class="nv">$para</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$confToma4</span><span class="p">[</span><span class="nv">$para</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="nv">$para</span><span class="p">]);</span>
            			<span class="k">if</span><span class="p">(</span><span class="nv">$confToma4</span><span class="p">[</span><span class="nv">$para</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$enderToma</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$de</span><span class="p">,</span> <span class="nv">$confToma4</span><span class="p">[</span><span class="nv">$para</span><span class="p">]);</span>
            		<span class="p">}</span>
            		 
            		<span class="cm">/*if(!empty($confToma4['toma_data_ent_cont']))
            		 $enderToma-&gt;addChild('dhCont', implode('T', explode(' ', $confToma4['toma_data_ent_cont'])));*/</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$toma03</span> <span class="o">=</span> <span class="nv">$ide</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'toma03'</span><span class="p">);</span>
            		<span class="nv">$toma03</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'toma'</span><span class="p">,</span> <span class="nv">$confToma</span><span class="p">);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setCompl</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="c1">//		if($this-&gt;validaInputacao($config)) {</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$compl</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'compl'</span><span class="p">);</span>

            	<span class="nv">$confComplPrimeiroBloco</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
					<span class="s1">'xCaracAd'</span><span class="p">,</span> 
					<span class="s1">'xCaracSer'</span><span class="p">,</span> 
					<span class="s1">'xEmi'</span>
					<span class="p">);</span>

					<span class="k">foreach</span><span class="p">(</span><span class="nv">$confComplPrimeiroBloco</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
						<span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
						<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
						<span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">||</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
						<span class="nv">$fluxo</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fluxo'</span><span class="p">);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]))</span> <span class="p">{</span>
						<span class="nv">$fluxo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xOrig'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$pass</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xpass</span> <span class="o">=</span> <span class="nv">$fluxo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pass'</span><span class="p">);</span>

							<span class="nv">$nodesPass</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
						<span class="s1">'xPass'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_sigla_aeroporto_passagem'</span><span class="p">,</span>
						<span class="s1">'xDest'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_sigla_aeroporto_destino'</span><span class="p">,</span>
						<span class="s1">'xRota'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_codigo_rota_entrega'</span>
						<span class="p">);</span>
							
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$nodesPass</span> <span class="k">as</span> <span class="nv">$nodePass</span> <span class="o">=&gt;</span> <span class="nv">$nodePassIndex</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xpass</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$nodePass</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]);</span>
						<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">]))</span> <span class="p">{</span>
						<span class="nv">$Entrega</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'Entrega'</span><span class="p">);</span>

						<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>

						<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]</span><span class="o">==</span><span class="s2">""</span><span class="p">)</span>

						<span class="k">switch</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">])</span> <span class="p">{</span>
							<span class="k">case</span> <span class="s1">'0'</span> <span class="o">:</span>
								<span class="nv">$semData</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'semData'</span><span class="p">);</span>
								<span class="nv">$semData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'1'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'2'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'3'</span> <span class="o">:</span>
								<span class="nv">$comData</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'comData'</span><span class="p">);</span>
								<span class="nv">$comData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]);</span>

								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$comData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]);</span>
								
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'4'</span> <span class="o">:</span>
								<span class="nv">$noPeriodo</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'noPeriodo'</span><span class="p">);</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dtIni'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]);</span>
								
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dtFim'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]);</span>
								
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>

						<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>

						<span class="k">switch</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">])</span> <span class="p">{</span>
							<span class="k">case</span> <span class="s1">'0'</span> <span class="o">:</span>
								<span class="nv">$semHora</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'semHora'</span><span class="p">);</span>
								<span class="nv">$semHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'1'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'2'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'3'</span> <span class="o">:</span>
								<span class="nv">$comHora</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'comHora'</span><span class="p">);</span>
								<span class="nv">$comHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$comHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'4'</span> <span class="o">:</span>
								<span class="nv">$noInter</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'noInter'</span><span class="p">);</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'hIni'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'hFim'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'xObs'</span><span class="p">])</span> <span class="p">){</span>
						<span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xObs'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'xObs'</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$ObsCont</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xObsCont</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ObsCont'</span><span class="p">);</span>

							<span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsCont</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCampo'</span><span class="p">,</span> <span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]);</span>
							<span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsCont</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xTexto'</span><span class="p">,</span> <span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$ObsFisco</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xObsFisco</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ObsFisco'</span><span class="p">);</span>

							<span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsFisco</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCampo'</span><span class="p">,</span> <span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]);</span>
							<span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsFisco</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xTexto'</span><span class="p">,</span> <span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
					<span class="c1">//		}</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setEmitValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$emitDePara</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
			<span class="s1">'CNPJ'</span> <span class="o">=&gt;</span> <span class="s1">'CNPJ'</span><span class="p">,</span>
			<span class="s1">'IE'</span> <span class="o">=&gt;</span> <span class="s1">'IE'</span><span class="p">,</span>
			<span class="s1">'xNome'</span> <span class="o">=&gt;</span> <span class="s1">'nome_razao'</span><span class="p">,</span>
			<span class="s1">'xFant'</span> <span class="o">=&gt;</span> <span class="s1">'fantasia'</span>
			<span class="p">);</span>

			<span class="nv">$camposObrigatorios</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
			<span class="c1">//omitted code 3 lines</span>
			<span class="p">);</span>

			<span class="nv">$emit</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'emit'</span><span class="p">);</span>

			<span class="k">foreach</span><span class="p">(</span><span class="nv">$emitDePara</span> <span class="k">as</span> <span class="nv">$node</span> <span class="o">=&gt;</span> <span class="nv">$nodeValue</span><span class="p">)</span> <span class="p">{</span>
				<span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]);</span>
					
				<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
					<span class="nv">$emit</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$camposObrigatorios</span><span class="p">))</span> <span class="p">{</span>
						<span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="nv">$camposObrigatorios</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>

			<span class="nv">$emitEnderDePara</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
				<span class="s1">'xLgr'</span> <span class="o">=&gt;</span> <span class="s1">'logradouro'</span><span class="p">,</span>
				<span class="s1">'nro'</span> <span class="o">=&gt;</span> <span class="s1">'numero'</span><span class="p">,</span>
				<span class="s1">'xCpl'</span> <span class="o">=&gt;</span> <span class="s1">'complemento'</span><span class="p">,</span>
				<span class="s1">'xBairro'</span> <span class="o">=&gt;</span> <span class="s1">'bairro'</span><span class="p">,</span>
				<span class="s1">'cMun'</span> <span class="o">=&gt;</span> <span class="s1">'cod_municipio'</span><span class="p">,</span>
				<span class="s1">'xMun'</span> <span class="o">=&gt;</span> <span class="s1">'municipio'</span><span class="p">,</span>
				<span class="s1">'UF'</span> <span class="o">=&gt;</span> <span class="s1">'UF'</span><span class="p">,</span>
				<span class="s1">'fone'</span> <span class="o">=&gt;</span> <span class="s1">'fone'</span>
				<span class="p">);</span>
					
				<span class="nv">$camposObrigatoriosEnder</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
				<span class="c1">//omitted code 7 lines</span>
				<span class="p">);</span>
					
				<span class="nv">$enderEmit</span> <span class="o">=</span> <span class="nv">$emit</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderEmit'</span><span class="p">);</span>
					
				<span class="k">foreach</span><span class="p">(</span><span class="nv">$emitEnderDePara</span> <span class="k">as</span> <span class="nv">$node</span> <span class="o">=&gt;</span> <span class="nv">$nodeValue</span><span class="p">)</span> <span class="p">{</span>
					<span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]);</span>

					<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
						<span class="nv">$enderEmit</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$nodeValue</span><span class="p">]);</span>
					<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
						<span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$camposObrigatoriosEnder</span><span class="p">))</span> <span class="p">{</span>
							<span class="k">throw</span> <span class="k">new</span> <span class="nc">Exception</span><span class="p">(</span><span class="nv">$camposObrigatoriosEnder</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>
				<span class="p">}</span>
					
				<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setRemValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$config</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">limpaEspacos</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$rem</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'rem'</span><span class="p">);</span>
            	<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">],</span> <span class="mi">14</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">],</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="s1">'000000000'</span><span class="p">);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="no">TIPO_AMBIENTE_CTE</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL'</span><span class="p">;</span>
            		<span class="nv">$config</span><span class="p">[</span><span class="s1">'xFant'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL'</span><span class="p">;</span>
            	<span class="p">}</span>

            	<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]);</span>
            	<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xFant'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]);</span>

            	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">])){</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="nv">$enderReme</span> <span class="o">=</span> <span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderReme'</span><span class="p">);</span>

            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xLgr'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'logradouro'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nro'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'numero'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCpl'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'bairro'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xBairro'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'bairro'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_municipio'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'municipio'</span><span class="p">]);</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CEP'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">],</span> <span class="mi">8</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'UF'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">]);</span>
            	<span class="nv">$enderReme</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">]);</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rem</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	
            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>

            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">setDestValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$dest</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dest'</span><span class="p">);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="s1">'000000000'</span><span class="p">);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="no">TIPO_AMBIENTE_CTE</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL'</span><span class="p">;</span>
            	<span class="p">}</span>

            	<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$enderDest</span> <span class="o">=</span> <span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderDest'</span><span class="p">);</span>
            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xLgr'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'logradouro'</span><span class="p">]);</span>
            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nro'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'numero'</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCpl'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xBairro'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'bairro'</span><span class="p">]);</span>
            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_municipio'</span><span class="p">]);</span>
            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'municipio'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CEP'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">]),</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'UF'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderDest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$dest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]);</span>
            	<span class="p">}</span>

            

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">setRecValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$rec</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'receb'</span><span class="p">);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="s1">'000000000'</span><span class="p">);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="no">TIPO_AMBIENTE_CTE</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL'</span><span class="p">;</span>
            	<span class="p">}</span>
            	<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="nv">$enderRec</span> <span class="o">=</span> <span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderReceb'</span><span class="p">);</span>
            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xLgr'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'logradouro'</span><span class="p">]);</span>
            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nro'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'numero'</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCpl'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xBairro'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'bairro'</span><span class="p">]);</span>
            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_municipio'</span><span class="p">]);</span>
            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'municipio'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CEP'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'UF'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">])</span> <span class="p">){</span>
            		<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span> <span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$enderRec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rec</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]);</span>
            	<span class="p">}</span>
            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setExpValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>
            	<span class="nv">$exp</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'exped'</span><span class="p">);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cpfcnpj'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">is_numeric</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="s1">'000000000'</span><span class="p">);</span>
            	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'IE'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="no">TIPO_AMBIENTE_CTE</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'CT-E EMITIDO EM AMBIENTE DE HOMOLOGACAO - SEM VALOR FISCAL'</span><span class="p">;</span>
            	<span class="p">}</span>
            	<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'nome'</span><span class="p">]);</span>

            	<span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fone'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$enderExp</span> <span class="o">=</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'enderExped'</span><span class="p">);</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xLgr'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'logradouro'</span><span class="p">]);</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nro'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'numero'</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">]))</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCpl'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'complemento'</span><span class="p">]);</span>

            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xBairro'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'bairro'</span><span class="p">]);</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_municipio'</span><span class="p">]);</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xMun'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'municipio'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">]))</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CEP'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CEP'</span><span class="p">]);</span>

            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'UF'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'cod_pais'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            	<span class="nv">$enderExp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xPais'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pais'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$exp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'email'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            
            <span class="k">public</span> <span class="k">function</span> <span class="n">setInfCteComp</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'chave'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$infCteComp</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infCteComp'</span><span class="p">);</span>
            		<span class="nv">$infCteComp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'chave'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'chave'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setInfCteAnu</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'chCte'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'dEmi'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$infCteAnu</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infCteAnu'</span><span class="p">);</span>
            		<span class="nv">$infCteAnu</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'chCte'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'chCte'</span><span class="p">]);</span>
            		<span class="nv">$infCteAnu</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dEmi'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'dEmi'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setAutXML</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span> <span class="k">as</span> <span class="nv">$cda</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$autXML</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'autXML'</span><span class="p">);</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$cda</span><span class="p">[</span><span class="s1">'cda_cpf_cnpj_autori'</span><span class="p">])</span> <span class="o">==</span> <span class="mi">14</span><span class="p">)</span>
            		<span class="nv">$autXML</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$cda</span><span class="p">[</span><span class="s1">'cda_cpf_cnpj_autori'</span><span class="p">]);</span>
            		<span class="k">else</span>
            		<span class="nv">$autXML</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$cda</span><span class="p">[</span><span class="s1">'cda_cpf_cnpj_autori'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setModalRodoviario</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>
            	<span class="nv">$rodo</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="n">infCTeNorm</span><span class="o">-&gt;</span><span class="n">infModal</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'rodo'</span><span class="p">);</span>
            	<span class="nv">$modal</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'rodo'</span><span class="p">];</span>

            	<span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'RNTRC'</span><span class="p">,</span> <span class="nv">$modal</span><span class="p">[</span><span class="s1">'RNTRC'</span><span class="p">]);</span>
            	<span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dPrev'</span><span class="p">,</span> <span class="nv">$modal</span><span class="p">[</span><span class="s1">'dPrev'</span><span class="p">]);</span>
            	<span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'lota'</span><span class="p">,</span> <span class="nv">$modal</span><span class="p">[</span><span class="s1">'lota'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'CIOT'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CIOT'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'CIOT'</span><span class="p">]),</span> <span class="mi">12</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'occ'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'occ'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'occ'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$occ</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$xocc</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'occ'</span><span class="p">);</span>

            			<span class="nv">$xocc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'serie'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_serie'</span><span class="p">]);</span>
            			<span class="nv">$xocc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nOcc'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_numero'</span><span class="p">]);</span>
            			<span class="nv">$xocc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dEmi'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_demi'</span><span class="p">]);</span>

            			<span class="nv">$emiOcc</span> <span class="o">=</span> <span class="nv">$xocc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'emiOcc'</span><span class="p">);</span>

            			<span class="nv">$emiOcc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_cnpj'</span><span class="p">]);</span>

            			<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_cint'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$emiOcc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cInt'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_cint'</span><span class="p">]);</span>

            			<span class="nv">$emiOcc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_ie'</span><span class="p">]);</span>
            			<span class="nv">$emiOcc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'Uf'</span><span class="p">][</span><span class="s1">'uf_sigla'</span><span class="p">]);</span>

            			<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_fone'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$emiOcc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fone'</span><span class="p">,</span> <span class="nv">$occ</span><span class="p">[</span><span class="s1">'occ_fone'</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'valePed'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'valePed'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'valePed'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$valePed</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$xValePed</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'valePed'</span><span class="p">);</span>

            			<span class="nv">$xValePed</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJForn'</span><span class="p">,</span> <span class="nv">$valePed</span><span class="p">[</span><span class="s1">'vpd_cnpj_forn'</span><span class="p">]);</span>
            			<span class="nv">$xValePed</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nCompra'</span><span class="p">,</span> <span class="nv">$valePed</span><span class="p">[</span><span class="s1">'vpd_ncompra'</span><span class="p">]);</span>

            			<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$valePed</span><span class="p">[</span><span class="s1">'vpd_cnpj_pg'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$xValePed</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJPg'</span><span class="p">,</span> <span class="nv">$valePed</span><span class="p">[</span><span class="s1">'vpd_cnpj_pg'</span><span class="p">]);</span>

            			<span class="nv">$xValePed</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vValePed'</span><span class="p">,</span> <span class="nv">$valePed</span><span class="p">[</span><span class="s1">'vpd_valor_vale_pedagio'</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'veic'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'veic'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'veic'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$confVeic</span><span class="p">){</span>
            			<span class="nv">$veic</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'veic'</span><span class="p">);</span>

            			<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_cod_interno'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cInt'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_cod_interno'</span><span class="p">]);</span>

            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'RENAVAM'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_renavam'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'placa'</span><span class="p">,</span> <span class="nb">str_replace</span><span class="p">(</span><span class="s1">' '</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_placa'</span><span class="p">]));</span> <span class="c1">// remove qualquer espa\E7o branco</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tara'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_tara'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'capKG'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_capacidade_kg'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'capM3'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_capacidade_mc'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpProp'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_proprietario'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpVeic'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'CteVeiculoTipo'</span><span class="p">][</span><span class="s1">'cvt_codigo'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpRod'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'CteVeiculoRodado'</span><span class="p">][</span><span class="s1">'cvr_codigo'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpCar'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'CteVeiculoCarroceria'</span><span class="p">][</span><span class="s1">'cvc_codigo'</span><span class="p">]);</span>
            			<span class="nv">$veic</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'Uf'</span><span class="p">][</span><span class="s1">'uf_sigla'</span><span class="p">]);</span>

            			<span class="k">if</span><span class="p">(</span><span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_proprietario'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'P'</span><span class="p">)</span> <span class="p">{</span>
            				<span class="nv">$prop</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'prop'</span><span class="p">);</span>
            				<span class="nv">$infoVeicProp</span> <span class="o">=</span> <span class="nc">CteVeiculo</span><span class="o">::</span><span class="nf">consultaVeiculo</span><span class="p">(</span><span class="nv">$confVeic</span><span class="p">[</span><span class="s1">'CteVeiculo'</span><span class="p">][</span><span class="s1">'cve_id'</span><span class="p">]);</span>
            				 
            				<span class="nv">$veicProp</span> <span class="o">=</span> <span class="nb">reset</span><span class="p">(</span><span class="nv">$infoVeicProp</span><span class="p">[</span><span class="s1">'CteEmpresaVeiculoProprietarioAtrb'</span><span class="p">]);</span>
            				<span class="nv">$veicPropTipo</span> <span class="o">=</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'CteEmpresaVeiculoProprietarioTipo'</span><span class="p">];</span>
            				 
            				<span class="k">if</span><span class="p">(</span><span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_tipo_pessoa'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'FIS'</span><span class="p">){</span>
            					<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_cpf_cnpj'</span><span class="p">]);</span>
            				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            					<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CNPJ'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_cpf_cnpj'</span><span class="p">]);</span>
            				<span class="p">}</span>
            				<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'RNTRC'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_rntrc'</span><span class="p">]);</span>
            				<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_nome_razao'</span><span class="p">]);</span>
            				<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'IE'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'evpa_rg_ie'</span><span class="p">]);</span>
            				<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'UF'</span><span class="p">,</span> <span class="nv">$veicProp</span><span class="p">[</span><span class="s1">'Uf'</span><span class="p">][</span><span class="s1">'uf_sigla'</span><span class="p">]);</span>
            				<span class="nv">$prop</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpProp'</span><span class="p">,</span> <span class="nv">$veicPropTipo</span><span class="p">[</span><span class="s1">'evpt_codigo'</span><span class="p">]);</span>
            			<span class="p">}</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'lacre'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'lacre'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'lacre'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$infLacre</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$lacRodo</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'lacRodo'</span><span class="p">);</span>

            			<span class="nv">$lacRodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nLacre'</span><span class="p">,</span> <span class="nv">$infLacre</span><span class="p">[</span><span class="s1">'cmrl_num_lacre'</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'moto'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'moto'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$modal</span><span class="p">[</span><span class="s1">'moto'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$infMoto</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$moto</span> <span class="o">=</span> <span class="nv">$rodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'moto'</span><span class="p">);</span>

            			<span class="nv">$moto</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="nv">$infMoto</span><span class="p">[</span><span class="s1">'CteMotorista'</span><span class="p">][</span><span class="s1">'mot_nome'</span><span class="p">]);</span>
            			<span class="nv">$moto</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CPF'</span><span class="p">,</span> <span class="nv">$infMoto</span><span class="p">[</span><span class="s1">'CteMotorista'</span><span class="p">][</span><span class="s1">'mot_cpf'</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setVPrestValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$vPrest</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vPrest'</span><span class="p">);</span>

            	<span class="nv">$vPrest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vTPrest'</span><span class="p">,</span> <span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'vTPrest'</span><span class="p">])</span><span class="o">?</span> <span class="s1">'0.00'</span> <span class="o">:</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vTPrest'</span><span class="p">]);</span>
            	<span class="nv">$vPrest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vRec'</span><span class="p">,</span> <span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'vRec'</span><span class="p">])</span><span class="o">?</span> <span class="s1">'0.00'</span> <span class="o">:</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vRec'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Comp'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Comp'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="c1">// \E8 obrigat\F3rio ter um elemento filho do Comp para emitir a nota</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Comp'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$Comp</span><span class="p">)</span> <span class="p">{</span>
            			<span class="c1">// \E8 necess\E1rio fazer a verifica\E7\E3o para n\E3o ocorrer erros no xml</span>
            			<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_nome_componente'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_valor_componente'</span><span class="p">])</span> <span class="p">){</span>
            				<span class="nv">$xComp</span> <span class="o">=</span> <span class="nv">$vPrest</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'Comp'</span><span class="p">);</span>
            				<span class="c1">// verificar se esse campo \E9 vazio caso contr\E1rio ocorrer\E1 um erro no xml</span>
            				<span class="nv">$xComp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNome'</span><span class="p">,</span> <span class="p">(</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_nome_componente'</span><span class="p">]))</span><span class="o">?</span> <span class="s1">'ND'</span> <span class="o">:</span> <span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_nome_componente'</span><span class="p">]);</span>
            				<span class="nv">$xComp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vComp'</span><span class="p">,</span> <span class="p">(</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_valor_componente'</span><span class="p">]))</span><span class="o">?</span> <span class="s1">'00.00'</span> <span class="o">:</span> <span class="nv">$Comp</span><span class="p">[</span><span class="s1">'cic_valor_componente'</span><span class="p">]);</span> <span class="c1">//13,2 ER25 15 posi\E7\F5es, sendo 13 inteiras e 2 decimais.</span>
            			<span class="p">}</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setImpValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$imp</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'imp'</span><span class="p">);</span>

            	<span class="nv">$ICMS</span> <span class="o">=</span> <span class="nv">$imp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS'</span><span class="p">);</span>

            	<span class="k">switch</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">])</span> <span class="p">{</span>
            		<span class="k">case</span> <span class="s1">'00'</span> <span class="o">:</span>
            			<span class="nv">$ICMS00</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS00'</span><span class="p">);</span>

            			<span class="nv">$ICMS00</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">]);</span>
            			<span class="nv">$ICMS00</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBC'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vBC'</span><span class="p">]);</span>
            			<span class="nv">$ICMS00</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pICMS'</span><span class="p">]);</span>
            			<span class="nv">$ICMS00</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vICMS'</span><span class="p">]);</span>
            			<span class="k">break</span><span class="p">;</span>
            		<span class="k">case</span> <span class="s1">'20'</span> <span class="o">:</span>
            			<span class="nv">$ICMS20</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS20'</span><span class="p">);</span>
            			<span class="nv">$ICMS20</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">]);</span>
            			<span class="nv">$ICMS20</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pRedBC'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pRedBC'</span><span class="p">]);</span>
            			<span class="nv">$ICMS20</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBC'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vBC'</span><span class="p">]);</span>
            			<span class="nv">$ICMS20</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pICMS'</span><span class="p">]);</span>
            			<span class="nv">$ICMS20</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vICMS'</span><span class="p">]);</span>
            			<span class="k">break</span><span class="p">;</span>

            		<span class="k">case</span> <span class="s1">'40'</span> <span class="o">:</span>
            		<span class="k">case</span> <span class="s1">'41'</span> <span class="o">:</span>
            		<span class="k">case</span> <span class="s1">'51'</span> <span class="o">:</span>
            			<span class="nv">$ICMS45</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS45'</span><span class="p">);</span>
            			<span class="nv">$ICMS45</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">]);</span>
            			<span class="k">break</span><span class="p">;</span>

            		<span class="k">case</span> <span class="s1">'60'</span> <span class="o">:</span>
            			<span class="nv">$ICMS60</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS60'</span><span class="p">);</span>

            			<span class="nv">$ICMS60</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">]);</span>
            			<span class="nv">$ICMS60</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBCSTRet'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vBCSTRet'</span><span class="p">]);</span>
            			<span class="nv">$ICMS60</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMSSTRet'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vICMSSTRet'</span><span class="p">]);</span>
            			<span class="nv">$ICMS60</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pICMSSTRet'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pICMSSTRet'</span><span class="p">]);</span>
            			<span class="nv">$ICMS60</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vCred'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vCred'</span><span class="p">]);</span>
            			<span class="k">break</span><span class="p">;</span>

            		<span class="k">case</span> <span class="s1">'90'</span> <span class="o">:</span>
            			<span class="nv">$ICMS90</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMS90'</span><span class="p">);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'CST'</span><span class="p">]);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pRedBC'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pRedBC'</span><span class="p">]);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBC'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vBC'</span><span class="p">]);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pICMS'</span><span class="p">]);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMS'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Vicms'</span><span class="p">]);</span>
            			<span class="nv">$ICMS90</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vCred'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vCred'</span><span class="p">]);</span>
            			<span class="k">break</span><span class="p">;</span>

            		<span class="k">case</span> <span class="s1">'SN'</span> <span class="o">:</span>
            			<span class="nv">$ICMSSN</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMSSN'</span><span class="p">);</span>
            			<span class="nv">$ICMSSN</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'indSN'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
            			<span class="k">break</span><span class="p">;</span>

            		<span class="k">default</span><span class="o">:</span> <span class="c1">// Default ser\E1 outra UF</span>
            			<span class="nv">$ICMSOutraUF</span> <span class="o">=</span> <span class="nv">$ICMS</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ICMSOutraUF'</span><span class="p">);</span>

            			<span class="nv">$ICMSOutraUF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'CST'</span><span class="p">,</span> <span class="s1">'90'</span><span class="p">);</span>
            			<span class="nv">$ICMSOutraUF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pRedBCOutraUF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pRedBCOutraUF'</span><span class="p">]);</span>
            			<span class="nv">$ICMSOutraUF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBCOutraUF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vBCOutraUF'</span><span class="p">]);</span>
            			<span class="nv">$ICMSOutraUF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pICMSOutraUF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'pICMSOutraUF'</span><span class="p">]);</span>
            			<span class="nv">$ICMSOutraUF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMSOutraUF'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vICMSOutraUF'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'vTotTrib'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$imp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vTotTrib'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'vTotTrib'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'infAdFisco'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$imp</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infAdFisco'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'infAdFisco'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">setInfCTeNormValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$infCTeNorm</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infCTeNorm'</span><span class="p">);</span>
            	<span class="nv">$dInfCarga</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'infCarga'</span><span class="p">];</span>

            	<span class="nv">$infCarga</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infCarga'</span><span class="p">);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span> <span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'vCarga'</span><span class="p">])</span> <span class="o">!=</span> <span class="s1">''</span> <span class="p">){</span>
            		<span class="nv">$infCarga</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vCarga'</span><span class="p">,</span> <span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'vCarga'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span> <span class="p">(</span> <span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'proPred'</span><span class="p">])</span> <span class="p">){</span>
            		<span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'proPred'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'N/D'</span><span class="p">;</span>
            	<span class="p">}</span>
            	<span class="nv">$infCarga</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'proPred'</span><span class="p">,</span> <span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'proPred'</span><span class="p">]);</span>

            	<span class="k">if</span><span class="p">(</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'xOutCat'</span><span class="p">])</span> <span class="o">!=</span> <span class="s1">''</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$infCarga</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xOutCat'</span><span class="p">,</span> <span class="nv">$dInfCarga</span><span class="p">[</span><span class="s1">'xOutCat'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'infQ'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'infQ'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$dInfQ</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$infQ</span> <span class="o">=</span> <span class="nv">$infCarga</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infQ'</span><span class="p">);</span>

            			<span class="nv">$infQ</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cUnid'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfQ</span><span class="p">[</span><span class="s1">'cnc_codigo_unidade_medida'</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'0'</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">)</span><span class="cm">/*'01'*/</span><span class="p">);</span>
            			<span class="nv">$infQ</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpMed'</span><span class="p">,</span> <span class="nv">$dInfQ</span><span class="p">[</span><span class="s1">'cnc_tipo_medida'</span><span class="p">]</span><span class="cm">/*'PESO BRUTO'*/</span><span class="p">);</span>
            			<span class="nv">$infQ</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'qCarga'</span><span class="p">,</span> <span class="nv">$dInfQ</span><span class="p">[</span><span class="s1">'cnc_valor_componente'</span><span class="p">]</span><span class="cm">/*'12345678911.1154'*/</span><span class="p">);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

  
            	<span class="nv">$documentos</span> <span class="o">=</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'infDoc'</span><span class="p">];</span>
            	<span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$documentos</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$documentos</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">){</span>

            		<span class="nv">$infDoc</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infDoc'</span><span class="p">);</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$documentos</span> <span class="k">as</span> <span class="nv">$dInfDoc</span><span class="p">)</span> <span class="p">{</span>
            			
            			<span class="k">switch</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_tipo'</span><span class="p">])</span> <span class="p">{</span>
            				<span class="k">case</span> <span class="mi">1</span> <span class="o">:</span>
            					<span class="nv">$infNF</span> <span class="o">=</span> <span class="nv">$infDoc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infNF'</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nRoma'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_numero_romaneio'</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">)</span><span class="cm">/*'12315646156189189111'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nPed'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_numero_pedido'</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">)</span><span class="cm">/*'12315646156189189111'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'mod'</span><span class="p">,</span> <span class="s1">'01'</span><span class="cm">/*$dInfDoc['cnf_modelo_nota']'04'*/</span><span class="p">);</span>	<span class="c1">//Preencher com:01 - NF Modelo 01/1A e Avulsa;04 - NF de Produtor</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'serie'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_serie'</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">)</span><span class="cm">/*'1'*/</span><span class="p">);</span>

            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nDoc'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_numero'</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">)</span><span class="cm">/*'1'*/</span><span class="p">);</span>

            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dEmi'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_data_emissao'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'---'</span><span class="p">)</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_data_emissao'</span><span class="p">]</span> <span class="o">:</span> <span class="nb">date</span><span class="p">(</span><span class="s1">'Y-m-d'</span><span class="p">));</span> <span class="o">/</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBC'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_base_icms'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_base_icms'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'8047.11'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vICMS'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_total_icms'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_total_icms'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'965.65'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vBCST'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_base_icms_st'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_base_icms_st'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'123.00'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vST'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_icms_st'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_icms_st'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'123.00'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vProd'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_total_produtos'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_total_produtos'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'123.00'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vNF'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_total_nf'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_valor_total_nf'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'0.00'</span><span class="cm">/*'123.00'*/</span><span class="p">);</span>
            					<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nCFOP'</span><span class="p">,</span> <span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_cfop_prodominante'</span><span class="p">])</span><span class="o">?</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_cfop_prodominante'</span><span class="p">]</span> <span class="o">:</span> <span class="s1">'5353'</span><span class="cm">/*'5353'*/</span><span class="p">);</span>

            					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_peso_total'</span><span class="p">])</span> <span class="p">){</span>
            						<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nPeso'</span><span class="p">,</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_peso_total'</span><span class="p">]);</span>
            					<span class="p">}</span>

            					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_suframa'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span>
            						<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'PIN'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_suframa'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="cm">/*'123'*/</span><span class="p">));</span>
            					<span class="p">}</span>

            					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_data_prevista_entrega'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_data_prevista_entrega'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'---'</span> <span class="p">)</span> <span class="p">{</span> 
            						<span class="nv">$infNF</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dPrev'</span><span class="p">,</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_data_prevista_entrega'</span><span class="p">]);</span>
            					<span class="p">}</span>
            					<span class="k">break</span><span class="p">;</span>
            				<span class="k">case</span> <span class="mi">2</span> <span class="o">:</span>
            					<span class="nv">$infNFe</span> <span class="o">=</span> <span class="nv">$infDoc</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infNFe'</span><span class="p">);</span>
            					<span class="nv">$infNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'chave'</span><span class="p">,</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_chave_acesso'</span><span class="p">]);</span>

            					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_suframa'</span><span class="p">])</span> <span class="p">){</span>
            						<span class="nv">$infNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'PIN'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_suframa'</span><span class="p">],</span> <span class="mi">9</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            					<span class="p">}</span>

            					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_data_prevista'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_data_prevista'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'---'</span> <span class="p">){</span> 
            						<span class="nv">$infNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dPrev'</span><span class="p">,</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'cnf_eletronica_data_prevista'</span><span class="p">]);</span>
            					<span class="p">}</span>

            					<span class="nv">$unidadeTransporteNFe</span> <span class="o">=</span> <span class="nv">$dInfDoc</span><span class="p">[</span><span class="s1">'CteInfNotaFiscalUnidadeTransporte'</span><span class="p">];</span>
            					<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$unidadeTransporteNFe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            						<span class="k">foreach</span><span class="p">(</span><span class="nv">$unidadeTransporteNFe</span> <span class="k">as</span> <span class="nv">$dInfUnidTranspNFe</span><span class="p">)</span> <span class="p">{</span>
            							<span class="nv">$infUnidTranspNFe</span> <span class="o">=</span> <span class="nv">$infNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infUnidTransp'</span><span class="p">);</span>

            							<span class="nv">$infUnidTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpUnidTransp'</span><span class="p">,</span> <span class="nv">$dInfUnidTranspNFe</span><span class="p">[</span><span class="s1">'cut_tipo_unidade_transportadora'</span><span class="p">]);</span>
            							<span class="nv">$infUnidTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'idUnidTransp'</span><span class="p">,</span> <span class="nv">$dInfUnidTranspNFe</span><span class="p">[</span><span class="s1">'cut_identificacao_unidade_transportadora'</span><span class="p">]);</span>

            							<span class="nv">$lacresUnidTranspNFe</span> <span class="o">=</span> <span class="nv">$dInfUnidTranspNFe</span><span class="p">[</span><span class="s1">'CteInfNotaFiscalUnidadeTransporteLacre'</span><span class="p">];</span>

            							<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$lacresUnidTranspNFe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            								<span class="k">foreach</span><span class="p">(</span><span class="nv">$lacresUnidTranspNFe</span> <span class="k">as</span> <span class="nv">$dLacUnidTranspNFe</span><span class="p">)</span> <span class="p">{</span>
            									<span class="nv">$lacUnidTranspNFe</span> <span class="o">=</span> <span class="nv">$infUnidTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'lacUnidTransp'</span><span class="p">);</span>

            									<span class="nv">$lacUnidTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nLacre'</span><span class="p">,</span> <span class="nv">$dLacUnidTranspNFe</span><span class="p">[</span><span class="s1">'ctl_numero_lacre'</span><span class="p">]);</span>
            								<span class="p">}</span>
            							<span class="p">}</span>

            							<span class="nv">$unidadesDeCargaTransNFe</span> <span class="o">=</span> <span class="nv">$dInfUnidTranspNFe</span><span class="p">[</span><span class="s1">'CteInfNotaFiscalUnidadeCarga'</span><span class="p">];</span>

            							<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$unidadesDeCargaTransNFe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            								<span class="k">foreach</span><span class="p">(</span><span class="nv">$unidadesDeCargaTransNFe</span> <span class="k">as</span> <span class="nv">$dInfUnidCargaTranspNFe</span><span class="p">)</span> <span class="p">{</span>
            									<span class="nv">$infUnidCargaTranspNFe</span> <span class="o">=</span> <span class="nv">$infUnidTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'infUnidCarga'</span><span class="p">);</span>

            									<span class="nv">$infUnidCargaTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpUnidCarga'</span><span class="p">,</span> <span class="nv">$dInfUnidCargaTranspNFe</span><span class="p">[</span><span class="s1">'cuc_tipo_unidade_carga'</span><span class="p">]);</span>
            									<span class="nv">$infUnidCargaTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'idUnidCarga'</span><span class="p">,</span> <span class="nv">$dInfUnidCargaTranspNFe</span><span class="p">[</span><span class="s1">'cuc_identificacao_unidade_carga'</span><span class="p">]);</span>

            									<span class="nv">$lacresUnidCargaTranspNFe</span> <span class="o">=</span> <span class="nv">$dInfUnidCargaTranspNFe</span><span class="p">[</span><span class="s1">'CteInfNotaFiscalUnidadeCargaLacre'</span><span class="p">];</span>

            									<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$lacresUnidCargaTranspNFe</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            										<span class="k">foreach</span><span class="p">(</span><span class="nv">$lacresUnidCargaTranspNFe</span> <span class="k">as</span> <span class="nv">$dLacUnidCargaTranspNFe</span><span class="p">)</span> <span class="p">{</span>
            											<span class="nv">$lacUnidCargaTranspNFe</span> <span class="o">=</span> <span class="nv">$infUnidCargaTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'lacUnidCarga'</span><span class="p">);</span>

            											<span class="nv">$lacUnidCargaTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nLacre'</span><span class="p">,</span> <span class="nv">$dLacUnidCargaTranspNFe</span><span class="p">[</span><span class="s1">'ccl_numero_lacre'</span><span class="p">]);</span>
            										<span class="p">}</span>
            									<span class="p">}</span>

            									<span class="nv">$infUnidCargaTranspNFe</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'qtdRat'</span><span class="p">,</span> <span class="nv">$dInfUnidCargaTranspNFe</span><span class="p">[</span><span class="s1">'cuc_qtd_rateado'</span><span class="p">]);</span>
            								<span class="p">}</span>
            							<span class="p">}</span>
            						<span class="p">}</span>
            					<span class="p">}</span>
            					<span class="k">break</span><span class="p">;</span>
            			<span class="p">}</span>
            	
            	<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'seg'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$dSeg</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$seg</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'seg'</span><span class="p">);</span>
            		 
            		<span class="nv">$seg</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'respSeg'</span><span class="p">,</span> <span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_responsavel_seguro'</span><span class="p">]</span><span class="cm">/*'4'*/</span><span class="p">);</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_nome_seguradora'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$seg</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xSeg'</span><span class="p">,</span> <span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_nome_seguradora'</span><span class="p">]</span><span class="cm">/*'Zurich'*/</span><span class="p">);</span>
            		<span class="p">}</span>

            		<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_numero_apolice'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$seg</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nApol'</span><span class="p">,</span> <span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_numero_apolice'</span><span class="p">]);</span>
            		<span class="p">}</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_numero_averbacao'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$seg</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nAver'</span><span class="p">,</span> <span class="nb">str_pad</span><span class="p">(</span><span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_numero_averbacao'</span><span class="p">],</span> <span class="mi">20</span><span class="p">,</span> <span class="no">STR_PAD_LEFT</span><span class="p">));</span>
            		<span class="p">}</span>
            		<span class="c1">// Padr\E3o da carga \E9 13,2</span>
            		<span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_valor_carga_efeito_averbacao'</span><span class="p">])</span><span class="o">!=</span><span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_valor_carga_efeito_averbacao'</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">'000'</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$seg</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vCarga'</span><span class="p">,</span> <span class="nv">$dSeg</span><span class="p">[</span><span class="s1">'cns_valor_carga_efeito_averbacao'</span><span class="p">]</span><span class="cm">/*'47000.00'*/</span><span class="p">);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>


            	<span class="nv">$infModal</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xs:infModal'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'infModal'</span><span class="p">][</span><span class="s1">'xs:any'</span><span class="p">]</span><span class="o">-&gt;</span><span class="nf">asXML</span><span class="p">());</span>
            	<span class="nv">$infModal</span><span class="o">-&gt;</span><span class="nf">addAttribute</span><span class="p">(</span><span class="s1">'versaoModal'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'infModal'</span><span class="p">][</span><span class="s1">'versaoModal'</span><span class="p">]);</span>

            	<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'peri'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$dPeri</span><span class="p">)</span> <span class="p">{</span>
            		<span class="nv">$peri</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'peri'</span><span class="p">);</span>

            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'nONU'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_numero_onu'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xNomeAE'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_nome_apropriado_embarque_produto'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xClaRisco'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_classe_subclasse'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'grEmb'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_grupo_embarque'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'qTotProd'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_quantidade_total_produto'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'qVolTipo'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_quantidade_tipo_volume'</span><span class="p">]);</span>
            		<span class="nv">$peri</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pontoFulgor'</span><span class="p">,</span> <span class="nv">$dPeri</span><span class="p">[</span><span class="s1">'cno_ponto_fulgor'</span><span class="p">]);</span>
            	<span class="p">}</span>

            	<span class="c1">// Se existir carros novos \E9 obrigat\F3rio informar os campos abaixo</span>
            	<span class="k">if</span> <span class="p">(</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'veicNovos'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
            		<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'veicNovos'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$dVeicNovos</span><span class="p">)</span> <span class="p">{</span>
            			<span class="nv">$veicNovos</span> <span class="o">=</span> <span class="nv">$infCTeNorm</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'veicNovos'</span><span class="p">);</span>

            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'chassi'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_chassi_veiculo'</span><span class="p">]);</span>
            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cCor'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_cor_veiculo'</span><span class="p">]);</span>
            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCor'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_descricao_cor'</span><span class="p">]);</span>
            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'cMod'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_codigo_marca_modelo'</span><span class="p">]);</span>
            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vUnit'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_valor_unitario_veiculo'</span><span class="p">]);</span>
            			<span class="nv">$veicNovos</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'vFrete'</span><span class="p">,</span> <span class="nv">$dVeicNovos</span><span class="p">[</span><span class="s1">'cvt_frete_unitario'</span><span class="p">]);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>

            	<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">save</span><span class="p">(</span><span class="nv">$cte_id</span><span class="p">)</span> <span class="p">{</span>
            	<span class="k">try</span> <span class="p">{</span>
            		<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            		<span class="nv">$cteXml</span> <span class="o">=</span> <span class="nc">CteXmlTable</span><span class="o">::</span><span class="nf">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="nf">findOneByCteId</span><span class="p">(</span><span class="nv">$cte_id</span><span class="p">);</span>
            		 
            		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$cteXml</span> <span class="k">instanceof</span> <span class="nc">CteXml</span><span class="p">)</span>
            		<span class="nv">$cteXml</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CteXml</span><span class="p">();</span>
            		 
            		<span class="nv">$cteXml</span><span class="o">-&gt;</span><span class="n">ctx_xml</span> <span class="o">=</span> <span class="nv">$xml</span><span class="p">;</span>
            		<span class="nv">$cteXml</span><span class="o">-&gt;</span><span class="n">cte_id</span> <span class="o">=</span> <span class="nv">$cte_id</span><span class="p">;</span>
            		<span class="nv">$cteXml</span><span class="o">-&gt;</span><span class="n">ctx_qem</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            		 
            		<span class="nv">$cteXml</span><span class="o">-&gt;</span><span class="nf">save</span><span class="p">();</span>

            		<span class="k">return</span> <span class="nv">$this</span><span class="p">;</span>
            	<span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nc">Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">exit</span><span class="p">(</span><span class="nv">$e</span><span class="o">-&gt;</span><span class="nf">getMessage</span><span class="p">());</span>
            	<span class="p">}</span>
            <span class="p">}</span>
          

            <span class="k">private</span> <span class="k">function</span> <span class="n">limpaEspacos</span><span class="p">(</span><span class="nv">$arranjo</span><span class="p">)</span> <span class="p">{</span>
            	<span class="k">foreach</span><span class="p">(</span><span class="nv">$arranjo</span> <span class="k">as</span> <span class="nv">$indice</span> <span class="o">=&gt;</span> <span class="nv">$valor</span><span class="p">)</span> <span class="p">{</span>
            		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$valor</span><span class="p">))</span> <span class="p">{</span>
            			<span class="nv">$arranjo</span><span class="p">[</span><span class="nv">$indice</span><span class="p">]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$valor</span><span class="p">);</span>
            		<span class="p">}</span>
            	<span class="p">}</span>
            	<span class="k">return</span> <span class="nv">$arranjo</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">private</span> <span class="k">function</span> <span class="n">cleaner</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$str</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
            	<span class="k">return</span> <span class="nv">$str</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">public</span> <span class="k">function</span> <span class="n">calculaDv</span><span class="p">(</span><span class="nv">$cCT</span><span class="p">)</span> <span class="p">{</span>
            	<span class="c1">// omitted code with 11 lines</span>
            <span class="p">}</span>
             
            <span class="k">public</span> <span class="k">function</span> <span class="n">calculaChaveAcesso</span><span class="p">(</span><span class="nv">$cUF</span><span class="p">,</span> <span class="nv">$AAMM</span><span class="p">,</span> <span class="nv">$CNPJ</span><span class="p">,</span> <span class="nv">$mod</span><span class="p">,</span> <span class="nv">$serie</span><span class="p">,</span> <span class="nv">$nCT</span><span class="p">,</span> <span class="nv">$tpEmis</span><span class="p">,</span> <span class="nv">$cCT</span><span class="p">)</span> <span class="p">{</span>
		<span class="c1">// omitted code with 20 lines</span>
            <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="crying-thinkingandplanning">Crying, Thinking and Planning</h2>

<p>As you could see now we have a class with 1054 lines and our challenge is to transform it in testable code.
As a first step I’d recommend you to cry and as a second step we can start to think in what the code does and how can
we break it down in pieces.</p>

<p>In our code we have a couple of method that can be separated in classes instead of methods because they have its own
behavior for example the method setCompl($config) will add to our XML a bunch of nodes depending on some conditions
in this case is used a switch statement either a couple of if’s .</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">Compl</span> <span class="p">{</span>
<span class="k">public</span> <span class="k">function</span> <span class="n">setCompl</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$xml</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">getXml</span><span class="p">();</span>

            	<span class="nv">$compl</span> <span class="o">=</span> <span class="nv">$xml</span><span class="o">-&gt;</span><span class="n">infCte</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'compl'</span><span class="p">);</span>

            	<span class="nv">$confComplPrimeiroBloco</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
					<span class="s1">'xCaracAd'</span><span class="p">,</span> 
					<span class="s1">'xCaracSer'</span><span class="p">,</span> 
					<span class="s1">'xEmi'</span>
					<span class="p">);</span>

					<span class="k">foreach</span><span class="p">(</span><span class="nv">$confComplPrimeiroBloco</span> <span class="k">as</span> <span class="nv">$node</span><span class="p">)</span> <span class="p">{</span>
						<span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
						<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
						<span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$node</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="nv">$node</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">||</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span><span class="p">)</span> <span class="p">{</span>
						<span class="nv">$fluxo</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'fluxo'</span><span class="p">);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]))</span> <span class="p">{</span>
						<span class="nv">$fluxo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xOrig'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'xOrig'</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">""</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'fluxo'</span><span class="p">][</span><span class="s1">'pass'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$pass</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xpass</span> <span class="o">=</span> <span class="nv">$fluxo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'pass'</span><span class="p">);</span>

							<span class="nv">$nodesPass</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
						<span class="s1">'xPass'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_sigla_aeroporto_passagem'</span><span class="p">,</span>
						<span class="s1">'xDest'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_sigla_aeroporto_destino'</span><span class="p">,</span>
						<span class="s1">'xRota'</span> <span class="o">=&gt;</span> <span class="s1">'cdp_codigo_rota_entrega'</span>
						<span class="p">);</span>
							
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$nodesPass</span> <span class="k">as</span> <span class="nv">$nodePass</span> <span class="o">=&gt;</span> <span class="nv">$nodePassIndex</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xpass</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="nv">$nodePass</span><span class="p">,</span> <span class="nv">$pass</span><span class="p">[</span><span class="nv">$nodePassIndex</span><span class="p">]);</span>
						<span class="p">}</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">]))</span> <span class="p">{</span>
						<span class="nv">$Entrega</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'Entrega'</span><span class="p">);</span>

						<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>

						<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]</span><span class="o">==</span><span class="s2">""</span><span class="p">)</span>

						<span class="k">switch</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">])</span> <span class="p">{</span>
							<span class="k">case</span> <span class="s1">'0'</span> <span class="o">:</span>
								<span class="nv">$semData</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'semData'</span><span class="p">);</span>
								<span class="nv">$semData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'1'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'2'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'3'</span> <span class="o">:</span>
								<span class="nv">$comData</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'comData'</span><span class="p">);</span>
								<span class="nv">$comData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]);</span>

								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$comData</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dProg'</span><span class="p">]);</span>
								
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'4'</span> <span class="o">:</span>
								<span class="nv">$noPeriodo</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'noPeriodo'</span><span class="p">);</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpPer'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpPer'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dtIni'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtIni'</span><span class="p">]);</span>
								
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noPeriodo</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'dtFim'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'dtFim'</span><span class="p">]);</span>
								
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>

						<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>

						<span class="k">switch</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">])</span> <span class="p">{</span>
							<span class="k">case</span> <span class="s1">'0'</span> <span class="o">:</span>
								<span class="nv">$semHora</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'semHora'</span><span class="p">);</span>
								<span class="nv">$semHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'1'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'2'</span> <span class="o">:</span>
							<span class="k">case</span> <span class="s1">'3'</span> <span class="o">:</span>
								<span class="nv">$comHora</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'comHora'</span><span class="p">);</span>
								<span class="nv">$comHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$comHora</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hProg'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
							<span class="k">case</span> <span class="s1">'4'</span> <span class="o">:</span>
								<span class="nv">$noInter</span> <span class="o">=</span> <span class="nv">$Entrega</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'noInter'</span><span class="p">);</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'tpHor'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'tpHor'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'hIni'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hIni'</span><span class="p">]);</span>
								<span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]);</span>
								<span class="k">if</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
								<span class="nv">$noInter</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'hFim'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'Entrega'</span><span class="p">][</span><span class="s1">'hFim'</span><span class="p">]);</span>
								<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="nb">empty</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'xObs'</span><span class="p">])</span> <span class="p">){</span>
						<span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xObs'</span><span class="p">,</span> <span class="nv">$config</span><span class="p">[</span><span class="s1">'xObs'</span><span class="p">]);</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsCont'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$ObsCont</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xObsCont</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ObsCont'</span><span class="p">);</span>

							<span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsCont</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCampo'</span><span class="p">,</span> <span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_identificador'</span><span class="p">]);</span>
							<span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsCont</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xTexto'</span><span class="p">,</span> <span class="nv">$ObsCont</span><span class="p">[</span><span class="s1">'coic_obs'</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span><span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">foreach</span><span class="p">(</span><span class="nv">$config</span><span class="p">[</span><span class="s1">'ObsFisco'</span><span class="p">]</span> <span class="k">as</span> <span class="nv">$ObsFisco</span><span class="p">)</span> <span class="p">{</span>
							<span class="nv">$xObsFisco</span> <span class="o">=</span> <span class="nv">$compl</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'ObsFisco'</span><span class="p">);</span>

							<span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsFisco</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xCampo'</span><span class="p">,</span> <span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_identificador'</span><span class="p">]);</span>
							<span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">cleaner</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]);</span>
							<span class="k">if</span><span class="p">(</span><span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
							<span class="nv">$xObsFisco</span><span class="o">-&gt;</span><span class="nf">addChild</span><span class="p">(</span><span class="s1">'xTexto'</span><span class="p">,</span> <span class="nv">$ObsFisco</span><span class="p">[</span><span class="s1">'coif_obs'</span><span class="p">]);</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="nv">$this</span><span class="o">-&gt;</span><span class="nf">setXml</span><span class="p">(</span><span class="nv">$xml</span><span class="p">);</span>
					<span class="c1">//		}</span>
            <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>It is much better now, isn’t it? We’ve got one class with a one responsibility and very tiny just 146 lines although
this class we have just created could be improved as well but it is a subject to other post.
So we got what we need to do and we have a plan already:</p>

<ol>
  <li>Analyze the methods</li>
  <li>Extract and create new classes</li>
</ol>

<p>Our last step before go to unit test is substitute the source code to use or new class instead of the currently code
let’s find where is the <strong>setComple($config)</strong> and switch our code.</p>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">function</span> <span class="n">setIdeValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">,</span> <span class="nv">$Cte</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//omitted code</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">setCompl</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
            	<span class="nv">$newCode</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Compl</span><span class="p">();</span>
		<span class="nv">$newCode</span><span class="o">-&gt;</span><span class="nf">setCompl</span><span class="p">(</span><span class="nv">$config</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="n">setEmitValues</span><span class="p">(</span><span class="nv">$config</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//omitted code</span>
<span class="p">}</span>
</code></pre></div></div>

<p>3. Substitute legacy code to your new code</p>

<p><strong>Now we should test our code in order to see if its still working</strong>, once we
have this confirmation we can now create our unit tests and repeat the cycle
again. As you start refactoring all the legacy using those steps you’ll start
to have your source code with better quality, maintainability  and of course
testable.</p>

<h2 id="it-is-hard">It is hard</h2>

<p>It is not easy to restructure all the legacy with new code but the result
is amazing. You can fallow the ideology of baby steps in this refactor as well
so as you change the legacy to the new code you test to see if everything is
the same. The trick here is to be patient and change piece by piece.</p>

<p>Basically I tried to show one single way of do it but in the internet you can
find thousands.</p>

<ol>
  <li>Analyze the methods</li>
  <li>Extract and create new classes
3. Substitute legacy code to your new code</li>
  <li>Make sure everything is working
5. Create your unit tests</li>
</ol>

  </main>

  

<style>
#share-buttons {display: flex; justify-content: center; align-items: center;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #f12f46; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<div id="share-buttons" class="mb-5">
    <span>Share this on</span>
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://marabesi.com/tdd/2015/05/23/are-you-not-using-tdd-part-legacy-code.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https://marabesi.com/tdd/2015/05/23/are-you-not-using-tdd-part-legacy-code.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://marabesi.com/tdd/2015/05/23/are-you-not-using-tdd-part-legacy-code.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
</div>

  <div id="disqus_thread"></div>
</div>


      <div class="footer">
        <div class="footer-details">
          Designed by @tamyitokazo
        </div>
      </div>
    </div>

    
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-58623708-1', 'auto');
      ga('send', 'pageview');
    </script>
    

    <script async src="/assets/main-bundle.js"></script>
  </body>
</html>