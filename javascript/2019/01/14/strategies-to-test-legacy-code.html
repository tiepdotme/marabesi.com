<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

    <title>Strategies to test legacy code - PART 1</title>
    <meta name="description"
      content="Often developers have to deal with code base without test, which might leadto disconfort in maintaining the code base. In one hand there is the businessthat ...">

    <link rel="canonical" href="https://marabesi.com/javascript/2019/01/14/strategies-to-test-legacy-code.html">
    <link rel="alternate" type="application/rss+xml" title="Marabesi"
      href="https://marabesi.com/feed.xml">

    <meta property="og:title" content="Strategies to test legacy code - PART 1" />
    <meta property="og:site_name" content="marabesi.com" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://marabesi.com/javascript/2019/01/14/strategies-to-test-legacy-code.html" />
    <meta property="og:image"
      content="https://marabesi.com/images/posts/2019-01-14-strategies-to-test-legacy-code/cover.jpg" />
    <meta property="og:description"
      content="Often developers have to deal with code base without test, which might leadto disconfort in maintaining the code base. In one hand there is the businessthat ..." />

    <meta property="fb:app_id" content="536384943068161" />

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@MatheusMarabesi">
    <meta name="twitter:title" content="Strategies to test legacy code - PART 1">
    <meta name="twitter:description"
      content="Often developers have to deal with code base without test, which might leadto disconfort in maintaining the code base. In one hand there is the businessthat ...">
    <meta name="twitter:creator" content="@MatheusMarabesi">
    <meta name="twitter:image:src"
      content="https://marabesi.com/images/posts/2019-01-14-strategies-to-test-legacy-code/cover.jpg">

    <meta name="keywords" content="test,acceptance,code,unit,suite,change,testing,developer,class,refactoring,software,refactor,strategies,legacy code,acceptance test,confidence,strategy,slow,pyramid,unit test" />

    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">

    <link href="/assets/main-bundle.css" rel="stylesheet" />

    <!-- See https://goo.gl/OOhYW5 -->
    <link rel="manifest" href="/manifest.json">

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#3f51b5">

    <!-- Add to homescreen for Chrome on Android. Fallback for manifest.json -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Marabesi">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Marabesi">

    <!-- Homescreen icons -->
    <link rel="apple-touch-icon" href="/images/manifest/icon-48x48.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/images/manifest/icon-72x72.png">
    <link rel="apple-touch-icon" sizes="96x96" href="/images/manifest/icon-96x96.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/images/manifest/icon-144x144.png">
    <link rel="apple-touch-icon" sizes="192x192" href="/images/manifest/icon-192x192.png">

    <!-- Tile icon for Windows 8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/manifest/icon-144x144.png">
    <meta name="msapplication-TileColor" content="#3f51b5">
    <meta name="msapplication-tap-highlight" content="no">
  </head>

  <body class="font-sans overflow-x-hidden">
    <button class="update-button w-full text-white bg-marabesi-purple p-5 m-auto fixed pin-b z-50 hidden focus:outline-none font-bold">Update found, click to update</button>

    <div class="menu-wrapper flex fixed w-full bg-white z-50">
      <nav class="top-menu hidden md:flex justify-start container lg:justify-center md:m-auto md:pt-2 md:pb-2">
        <a href="/" class="hidden md:block">
          <img class="logo w-18 p-1" data-src="/images/logo.png" width="100" alt="marabesi.com logo - two m's and one dot" title="marabesi.com logo - two m's and one dot" />
        </a>

        <ul id="menu-list" class="container-menu hidden flex-col pl-5 md:flex md:pl-0 md:flex-row md:m-auto lg:m-0">
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/talks">
                Talks
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/about">
                About
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/newbie-guide">
                Dev guide
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/resources">
                software development
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/tests/">
                Tests
              </a>
            </li>
          
          
           
            <li class="item pt-2 pb-2 md:p-2">
              <a class="item-link no-underline" href="/calendar">
                Conferences
              </a>
            </li>
          
          
        </ul>
      </nav>

      <div class="w-full flex items-center h-12 pl-2 bg-white md:hidden">
        <svg id="menu" class="cursor-pointer w-10 h-10 p-2 text-marabesi-pink fill-current" xmlns="http://www.w3.org/2000/svg"
          x="0px" y="0px" width="50" height="50" viewBox="0 0 24 24">
          <path
            style="line-height:normal;text-indent:0;text-align:start;text-decoration-line:none;text-decoration-style:solid;text-decoration-color:#000;text-transform:none;block-progression:tb;isolation:auto;mix-blend-mode:normal"
            d="M 2 5 L 2 7 L 22 7 L 22 5 L 2 5 z M 2 11 L 2 13 L 22 13 L 22 11 L 2 11 z M 2 17 L 2 19 L 22 19 L 22 17 L 2 17 z"
            font-weight="400" font-family="sans-serif" white-space="normal" overflow="visible"></path>
        </svg>
      </div>
    </div>

    <div class="flex flex-col items-center justify-center p-5">
      <input type="text" id="search-input" placeholder="search" aria-label="search" class="focus:outline-none border border-marabesi-purple text-marabesi-purple w-full p-3 mb-2 container mt-20 lg:mt-12">
      <ul id="results-container"></ul>
    </div>

    <div class="shell-content">
      <div class="banner-highlight">
        <p class="font-normal text-lg py-4 md:text-3xl lg:text-4xl">
          <span class="apostrophe">‘‘</span>
          Code should be easy to understand.
          <span class="apostrophe">’’</span>
        </p>
        <p class="author text-xs">Dustin Boswell and Trevor Foucher - The Art Of Readable Code</p>
      </div>

        <div class="page-content container flex flex-col p-5 m-auto">
  <h1>Strategies to test legacy code - PART 1</h1>

  <main class="mb-5">
    <p>Often developers have to deal with code base without test, which might lead
to disconfort in maintaining the code base. In one hand there is the business
that needs a new feature or a bug fix ready for the users to use, and in
the other hand there is the developer without a guide to make sure that
the change in the code doesn’t make any side effect.</p>

<p>To refactor is the ability to change the code, without affecting it’s
behavior <strong>[1]</strong>. If the code is changed and it’s beahvior change, it is not
refactoring, it is changing code without confidence.</p>

<p>The following content aims to define strategies to refactor existing
code without tests.</p>

<h1 id="acceptance-testing">Acceptance testing</h1>

<p>The acceptance testing is, compared to the unit test slower to run and depends
on the integration of many components, it is the test that simulates a user
interacting with the application.</p>

<p>Often the acceptance testing (UI Tests) is used with a web driver, to open a browser and
start to reproduce the events that an user would have done <strong>[4]</strong>.</p>

<p>The pyramid of test though, gave it a label of being slow and that depends
on integration to be possible to test.</p>

<p><img src="https://martinfowler.com/articles/practical-test-pyramid/testPyramid.png" alt="Test pyramid. Font: https://martinfowler.com/articles/practical-test-pyramid.html" title="Test pyramid. Font: https://martinfowler.com/articles/practical-test-pyramid.htm" target="_blank" /></p>

<p>There are at least two reasons for
acceptance test be considered slow, the first is the need to use a web drive,
which creates a real browser environment to execute the test. The second is
related to the first, wich requires for each test to reset the browser instance.</p>

<p>The recommended approach is to have a few acceptance tests as possible.</p>

<h1 id="unit-test">Unit test</h1>

<p>The unit test is the test that tests the smallest part in the code, often
referred as a function. The unit tests is the test written by the developer
along the production code, following the pyramid test <strong>[2]</strong>, the unit test
is the type of test that should have the higher amount in the suite.</p>

<p>Unit test are fast to run and gives fast feedback to the developer while
writing the program. The opposite of acceptance testing.</p>

<h1 id="defining-a-strategy">Defining a strategy</h1>

<p>The first strategy to approach testing in legacy systems is to start by writing
acceptance testing via web driver.</p>

<p>The flow is to get confidence in as many scenarios as possible, in a way that
is possible to refactor the code with confidence. In PHP for instance, is possible
to use codeception. is recommended to follow the TDD metodology even with
acceptance test, the flow would be resumed in:</p>

<ol>
  <li>Write acceptance test</li>
  <li>Refactor the code to be possible to add unit test</li>
  <li>Execute the acceptance test</li>
</ol>

<p>The pro is to have a few testes which gives the developer confidence in
refactoring in as many scenarios as possible, in the other hand acceptance test
is slow to execute. Even a small change would take a few minutes to execute the
suite.</p>

<p><img src="/images/posts/2019-01-14-strategies-to-test-legacy-code/strategies-1.png" alt="TDD applied to acceptance" target="_blank" /></p>

<h1 id="iterating-over-the-strategy">Iterating over the strategy</h1>

<p>Having acceptance test in place is a start to start improving the test strategy.
As mentioned before acceptance test is slow to execute, in addition it should
be a few as possible in the test suite.</p>

<p>The acceptance test in the scenario gives the developer more conficen to start
refactoring, where the goal to achive is to increase the unit test based on the
acceptance test suite.</p>

<p>For each acceptance test is recommended to start to substitute the acceptance
test with the unit test doing refactoring, the recommended approach would be:</p>

<ol>
  <li>Identify which classes are touched by the acceptance test</li>
  <li>Pick one class and start to refactoring with the unit test
    <ol>
      <li>If the class does’t have a unit test, create a class for it</li>
      <li>If the class already have a unit test class, start to write the test</li>
    </ol>
  </li>
  <li>Repeat step 2 untill all acceptance tests is converted into unit test</li>
</ol>

<p>The last part is to remove specific cases in the acceptance testing suite, and
keep only the general ones, which covers the most basic flow.</p>

<p><img src="/images/posts/2019-01-14-strategies-to-test-legacy-code/strategies-2.png" alt="Iterating over the strategy" target="_blank" /></p>

<p>It is possible to keep with all the acceptance test suite in place as well,
just the execution approach would change from a developer point of view.</p>

<p>Once the unit test suite is good enough to have confidence, the developer at
each change would execute the suite to have feedback on the change. Whereas in
the acceptance suite would be executed only once the refactor is done.</p>

<h1 id="edit-27-2019---madridjs-talk">Edit 27, 2019 - MadridJs talk</h1>

<iframe src="//speakerdeck.com/player/bf58fda1a16f40bcbf881d6efbfa77c5" width="100%" height="399" style="border:0; padding:0; margin:0; background:transparent;" frameborder="0" allowtransparency="true" allowfullscreen="allowfullscreen" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>

<h1 id="references">References</h1>

<p><strong>[1]</strong> M. Fowler, Improving the Design of Existing Code(2nd Edition). 2018, p. 22.</p>

<p><strong>[2]</strong> M. Cohn, SUCCEEDING WITH AGILE. 2010, p. 312.</p>

<p><strong>[3]</strong> Ham Vocke, ‘The Practical Test Pyramid’, 2018. [Online]. Available: <a href="https://martinfowler.com/articles/practical-test-pyramid.html" target="_blank">https://martinfowler.com/articles/practical-test-pyramid.html</a>. [Accessed: 06 - Feb - 2019]</p>

<p><strong>[4]</strong> SeleniumHQ, ‘Selenium WebDriver’, 2018. [Online]. Available: <a href="Selenium WebDriver" target="blank">https://www.seleniumhq.org/projects/webdriver</a>. [Accessed: 06 - Feb - 2019]</p>

  </main>

  

<style>
#share-buttons {display: flex; justify-content: center; align-items: center;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #f12f46; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<div id="share-buttons" class="mb-5">
    <span>Share this on</span>
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://marabesi.com/javascript/2019/01/14/strategies-to-test-legacy-code.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="twitter" title="Share this on Twitter" onclick="window.open('https://twitter.com/intent/tweet?text=https://marabesi.com/javascript/2019/01/14/strategies-to-test-legacy-code.html');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://marabesi.com/javascript/2019/01/14/strategies-to-test-legacy-code.html&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
</div>

  <div id="disqus_thread"></div>
</div>


      <div class="footer">
        <div class="footer-details">
          Designed by @tamyitokazo
        </div>
      </div>
    </div>

    
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
          m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-58623708-1', 'auto');
      ga('send', 'pageview');
    </script>
    

    <script async src="/assets/main-bundle.js"></script>
  </body>
</html>